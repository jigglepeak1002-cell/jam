<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bear Maze â€“ Mobile Hardcore</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  touch-action: none;
  -webkit-tap-highlight-color: transparent;
}

body {
  background: #000;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

#game {
  text-align: center;
}

#wrapper {
  position: relative;
  width: 800px;
  height: 800px;
  max-width: 100vw;
  max-height: 100vw;
}

#bg {
  position: absolute;
  inset: 0;
  background: url("assets/jungle.png") center/cover no-repeat;
  filter: blur(2px);
}

canvas {
  position: absolute;
  inset: 0;
}

/* ðŸ“± MOBILE CONTROLS */
.controls {
  margin-top: 10px;
}

.controls button {
  width: 80px;
  height: 80px;
  font-size: 28px;
  margin: 5px;
  border-radius: 14px;
  border: none;
  background: #222;
  color: #fff;
  font-weight: bold;
}

.controls button:active {
  background: #555;
}
</style>
</head>

<body>

<div id="game">
  <div id="wrapper">
    <div id="bg"></div>
    <canvas id="canvas" width="800" height="800"></canvas>
  </div>

  <!-- ðŸ“± TOUCH CONTROLS -->
  <div class="controls">
    <div>
      <button id="up">â¬†</button>
    </div>
    <div>
      <button id="left">â¬…</button>
      <button id="down">â¬‡</button>
      <button id="right">âž¡</button>
    </div>
  </div>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

/* ---------- TUNING ---------- */
const SIZE = 25;
const TILE = 32;
const BEAR_SIZE = 50;
const MOTHER_SIZE = 56;
const SAFE_RADIUS = 4;
const OBSTACLE_RATE = 0.8;

/* ---------- MAZE ---------- */
let maze = Array.from({ length: SIZE }, () => Array(SIZE).fill(1));

function carve(x, y) {
  maze[y][x] = 0;
  const dirs = [[2,0],[-2,0],[0,2],[0,-2]].sort(() => Math.random() - 0.5);
  for (const [dx, dy] of dirs) {
    const nx = x + dx;
    const ny = y + dy;
    if (nx > 0 && ny > 0 && nx < SIZE-1 && ny < SIZE-1 && maze[ny][nx] === 1) {
      maze[y + dy/2][x + dx/2] = 0;
      carve(nx, ny);
    }
  }
}
carve(1,1);

function safeDistance(x,y,a,b){
  return Math.abs(x-a)+Math.abs(y-b);
}

for (let y=1;y<SIZE-1;y++){
  for (let x=1;x<SIZE-1;x++){
    if (maze[y][x]===0){
      let open=0;
      [[1,0],[-1,0],[0,1],[0,-1]].forEach(([dx,dy])=>{
        if (maze[y+dy][x+dx]===0) open++;
      });
      if (open===1 &&
          safeDistance(x,y,1,1)>SAFE_RADIUS &&
          safeDistance(x,y,SIZE-2,SIZE-2)>SAFE_RADIUS &&
          Math.random()<OBSTACLE_RATE) {
        maze[y][x]=2;
      }
    }
  }
}

maze[1][1]=0;
maze[SIZE-2][SIZE-2]=0;

const player={x:1,y:1};
const mother={x:SIZE-2,y:SIZE-2};

const bearImg=new Image();
bearImg.src="assets/bear.png";

const motherImg=new Image();
motherImg.src="assets/mother.png";

/* ---------- DRAW ---------- */
function drawMaze(){
  for(let y=0;y<SIZE;y++){
    for(let x=0;x<SIZE;x++){
      if(maze[y][x]===1){
        ctx.fillStyle="rgba(0,0,0,0.85)";
        ctx.fillRect(x*TILE,y*TILE,TILE,TILE);
      }
      if(maze[y][x]===2){
        ctx.fillStyle="#d00000";
        ctx.beginPath();
        ctx.arc(x*TILE+TILE/2,y*TILE+TILE/2,10,0,Math.PI*2);
        ctx.fill();
      }
    }
  }
}

function drawSprites(){
  ctx.drawImage(bearImg,player.x*TILE-8,player.y*TILE-8,BEAR_SIZE,BEAR_SIZE);
  ctx.drawImage(motherImg,mother.x*TILE-8,mother.y*TILE-8,MOTHER_SIZE,MOTHER_SIZE);
}

function render(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawMaze();
  drawSprites();
}

/* ---------- MOVE ---------- */
function move(dx,dy){
  const nx=player.x+dx;
  const ny=player.y+dy;
  const cell=maze[ny]?.[nx];
  if(cell===1||cell===undefined) return;
  if(cell===2){
    alert("ðŸ’¥ Wrong turn!");
    location.reload();
  }
  player.x=nx;
  player.y=ny;
  if(nx===mother.x&&ny===mother.y){
    alert("ðŸ» Reunited!");
    location.reload();
  }
  render();
}

/* ---------- TOUCH CONTROLS ---------- */
const bind = (id,dx,dy)=>{
  document.getElementById(id).addEventListener("touchstart",e=>{
    e.preventDefault();
    move(dx,dy);
  });
};

bind("up",0,-1);
bind("down",0,1);
bind("left",-1,0);
bind("right",1,0);

/* ---------- KEYBOARD ---------- */
document.addEventListener("keydown",e=>{
  if(e.key==="w") move(0,-1);
  if(e.key==="s") move(0,1);
  if(e.key==="a") move(-1,0);
  if(e.key==="d") move(1,0);
});

/* ---------- IMAGE LOAD ---------- */
let loaded=0;
[bearImg,motherImg].forEach(img=>{
  img.onload=()=>{ if(++loaded===2) render(); };
});
</script>

</body>
</html>
